import{$ as n}from"../HigLabo/HtmlElementQuery.js";var t=function(){function t(){this.element=null;this.editor=null;this.mentionList=[];this.imageUrlList=[]}return t.prototype.initialize=function(t){t!=null&&(this.element=t,window.ClassicEditor!=null&&this.initializeClassicEditor(),n(window).resize(this.window_Resize.bind(this)))},t.prototype.initializeClassicEditor=function(){var t=this.element,i=window.ClassicEditor;i.create(t,{language:"ja",toolbar:{items:["undo","redo","emoji","link","imageUpload","fileUpload","imageTextAlternative","removeFormat","alignment","bold","italic","highlight","blockQuote","codeBlock","heading","numberedList","bulletedList","imageStyle:full","imageStyle:side","mediaEmbed","insertTable","tableColumn","tableRow","mergeTableCells"]},link:{addTargetToExternalLinks:!0},mediaEmbed:{removeProviders:["instagram","twitter","googleMaps","flickr","facebook"]},codeBlock:{languages:[{language:"plaintext",label:"Plain text"},{language:"html",label:"HTML"},{language:"xml",label:"HTML/XML"},{language:"css",label:"CSS"},{language:"json",label:"JSON"},{language:"javascript",label:"JavaScript"},{language:"typescript",label:"TypeScript"},{language:"sql",label:"SQL"},{language:"graphql",label:"GraphQL"},{language:"c",label:"C"},{language:"cpp",label:"C++"},{language:"csharp",label:"C#"},{language:"java",label:"Java"},{language:"php",label:"PHP"},{language:"python",label:"Python"},{language:"ruby",label:"Ruby"},{language:"php",label:"PHP"},{language:"kotlin",label:"Kotlin"},{language:"go",label:"GO"},{language:"swift",label:"Swift"},{language:"bash",label:"Bash"},{language:"powershell",label:"PowerShell"},{language:"docker",label:"Docker"},{language:"yaml",label:"YAML"},{language:"diff",label:"Diff"},]},ckfinder:{uploadUrl:"/Api/File/CKEditor/Upload?CsrfToken="+n("#CsrfToken").getValue()},typing:{transformations:{include:[]}},emoji:{images:this.imageUrlList},mention:{feeds:[{marker:"@",feed:this.getFeedItem.bind(this),minimumCharacters:0,itemRenderer:this.renderMention.bind(this)}]}}).then(this.editor_Initialized.bind(this))},t.prototype.editor_Initialized=function(n){this.editor=n;this.element.richTextbox=this;n.model.document.on("change:data",this.documentData_Change.bind(this))},t.prototype.window_Resize=function(){this.setWidth()},t.prototype.regiseterReplaceTextareEventHandler=function(t){this.floatingRichTextboxPanel=t;n(document).on("focusin","[rich-textbox]",this.richTextArea_Focusin.bind(this))},t.prototype.richTextArea_Focusin=function(n){this.replaceTextbox(n);this.setFocus()},t.prototype.replaceTextbox=function(t){var r=n(t),u=n(this.floatingRichTextboxPanel),i=this,f;i.targetTextbox!=t&&(i.targetTextbox!=null&&(n(i.targetTextbox).setStyle("display","block"),i.targetTextbox.richTextbox=null),i.targetTextbox=t,i.targetTextbox.richTextbox=this,r.setStyle("display","none"),u.setStyle("display","block"),f=r.getParentElementList()[0],f.append(u.getFirstElement()),this.setWidth())},t.prototype.setWidth=function(){var t=this;if(t.targetTextbox!=null){var i=t.targetTextbox,r=n(this.floatingRichTextboxPanel),u=n(i).getParentElementList()[0];r.setStyle("width",n(u).getOuterWidth()+"px")}},t.prototype.documentData_Change=function(){},t.prototype.getFeedItem=function(n){function r(t){return i.filterMentionInvoke(t,n)}var t=this,i=this;return new Promise(function(n){setTimeout(function(){var i=t.mentionList.filter(r).slice(0,10);n(i)},100)})},t.prototype.filterMentionInvoke=function(n,t){if(this.filterMention!=null&&this.filterMention(n,t)==!1)return!1;var i=t.toLowerCase();return i.length==0||n.DisplayName.toLowerCase().includes(i)||n.UserID.toLowerCase().includes(i)},t.prototype.renderMention=function(n){var r=n,i=document.createElement("div"),t;return i.classList.add("user-record-panel"),t=document.createElement("span"),t.classList.add("user-name-link"),t.textContent=r.DisplayName,i.appendChild(t),i},t.prototype.getEditor=function(){return this.editor},t.prototype.getData=function(){return this.editor==null?n(this.element).getValue():this.editor.getData()},t.prototype.setData=function(n){this.element!=null&&this.editor.setData(n)},t.prototype.setTextAreaValue=function(t){n(this.element).setValue(t)},t.prototype.setFocus=function(){if(this.editor==null)return n(this.element).setFocus();this.editor.editing.view.focus()},t}();export{t as RichTextbox};